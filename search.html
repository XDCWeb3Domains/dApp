<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta charset="UTF-8"> 
<meta http-equiv="encoding" content="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=0"/>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://unpkg.com/paginationjs@2.1.5/dist/pagination.css" />
<link type="text/css" rel="stylesheet" href="/fonts/Fontawesome-pro/css/fontawesome.min.css" />
<link type="text/css" rel="stylesheet" href="/fonts/Fontawesome-pro/css/all.css" />
<link type="text/css" rel="stylesheet" href="/fonts/Nunito/fonts.css" />
<link type="text/css" rel="stylesheet" href="/lib/jQuery/PluginStack/Wow-js/animate.css" />
<link type="text/css" rel="stylesheet" href="/css/custom.css?v=4" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xdc3@1.3.13416/dist/web3.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootbox@5.5.2/bootbox.all.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap-notify@3.1.3/bootstrap-notify.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/paginationjs@2.1.5/dist/pagination.js"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@multiavatar/multiavatar/multiavatar.min.js"></script>
<script type="text/javascript" src="/lib/jQuery/PluginStack/Wow-js/wow.min.js?v=10"></script>
<script type="text/javascript" src="/js/custom.js?v=202"></script>
<script type="text/javascript" src="/networks-main.js?v=40"></script>
<link rel="icon" href="/favicon/favicon-96x96.png" />
<link rel="shortcut icon" href="/favicon/favicon-96x96.png" />
<title>XDC Web3 Domains (.xdc)</title>
<meta name="description" content="First XDC Name Service - Own Your Blockchain Domains" />
<style>
.warp-search{
	margin: 0 auto;
}
.warp-result .text-success{
	color: #003663!important;
}
.warp-form-search{
	max-width: 100%;
}
.form-search{
	border-radius: 5px;
    background: #fff;
    border: 1px solid #2e19a7;
	padding: 20px;
}
.form-search .txtdomain
{
	border-radius: 0px!important;
}
.warp-setavatar .btn-success {
	background-color: #003663!important;
	border-color: #003663!important;
}
.warp-result .text-success{
	color: #003663!important;
}

.btn-outline-success
{
	border: 1px solid #003663!important;
	color: #003663!important;
}
.loading {color: #003663!important;}

.btn-outline-success:hover
{
	background-color: #003663!important;
	color: #FFF!important;
}
.warp-result{
	padding-top: 20px;
	text-align: center;
	margin: 0 auto;
	margin-bottom: 50px;
}
.tld
{
	display:none;
}
.select-chain {
	font-size: 13px;
}

.btn-connect-wallet:hover{
	color: #FFF!important;
}

.select-chain .dropdown-toggle{
	color: #FFF;
	cursor: pointer;
	border-radius: 30px;
	border: 1px solid #DDD;
	padding: 11px 20px;
	background: rgb(0 0 0 / 10%);
}
.select-chain .dropdown-menu{
	top: 12px!important;
}

.select-chain .dropdown-menu:before {
    content: '';
    display: inline-block;
    border-left: 7px solid transparent;
    border-right: 7px solid transparent;
    border-bottom: 7px solid #ccc;
    border-bottom-color: rgba(0, 0, 0, 0.2);
    position: absolute;
    top: -7px;
    left: 9px;
}

.select-chain .dropdown-menu:after {
    content: '';
    display: inline-block;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid #ffffff;
    position: absolute;
    top: -6px;
    left: 10px;
}

.select-chain .list-item
{
	display: block;
	padding: 12px;
	border-bottom: 1px solid #DDD;
	cursor: pointer;
	font-size: 13px;
}

.select-chain .list-item-active
{
	font-weight: bold;
}

.select-chain .list-item:last-child
{
	border-bottom: none;
}

.chain-logo{
	width: 20px; 
	margin-right: 10px;
	margin-top: -5px;
}

.result-search {
	background-color: rgb(255, 255, 255);
	overflow: hidden;
	border-radius: 6px;
	-webkit-box-align: center;
	align-items: center;
	padding: 30px;
	margin: 0 auto;
}
.result-details .alert-info{
	background: #FFF;
}
.pricelist{
	max-width: 400px;
	margin: 0 auto;
}
.preview {
	position: relative;
	background: linear-gradient(45deg, #a061d0, #30d5c2);
	border-radius: 5px;
	
}
.preview .domainhere{
	position: absolute;
    top: 50%;
    left: 50px;
    color: #FFF;
    font-weight: bold;
    font-size: 25px;
	word-wrap: break-word;
}
.result-select {
	padding:10px;
	margin: 0px auto;
}

.domain-item {
	display: inline-block;
	padding: 15px;
	border: 1px solid #DDD;
	border-radius: 10px;
	margin: 7px;
	text-align: center;
	cursor: pointer;
}
.result-select .active{
	border: 2px solid #CCC!important;
}
.domain-item-name{
	font-weight: bold;
	font-size: 20px;
	display: block;
}

.domain-item-status{
	font-weight: bold;
	display: block;
	font-size: 20px;
}


.result-common{
	text-align: left;
}
.result-details{
	padding-bottom: 20px;
}
.result-logo{
	margin-right: 7px;
}
.result-logo img{
	max-width: 40px;
	margin-top: -5px;
}
.result-domain{
    font-weight: 700;
    font-size: 18px;
}
.result-status{
	float: right;
	margin-top: 5px;
}
.result-status span{
	margin-left:7px;
}
.result-statustext{
	font-weight: bold;
}
.pricelistwarp{
	background: #FFF;
}
.result-price{
	padding:15px; font-size: 20px; font-weight: bold;
}
.pricelist{
	font-size: 15px;
}
.level-item{
	display: flex;
    align-items: center;
    padding-bottom: 7px;
    justify-content: space-between;
}
.level-price {
	font-weight: bold;
}
.warp-mydomains{
	margin-top: 50px;
    margin: 0 auto;
}

.mydomains{
	margin: 0 auto;
	border-radius: 6px;
	margin: 0 auto;
	padding: 30px;
	background-color: rgb(255, 255, 255);
}

.mydomains h4{
	border-bottom: 1px solid #DDD;
	padding-bottom: 10px;
}


.mydomain-show{
	margin-top:20px;
	display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
}

.mydomain-paging{
	margin-top: 30px;
	border-top: 1px solid #DDD;
	padding-top: 10px;

}
.mydomain-paging .padding{
	text-align: center!important;
	margin: 0 auto;
}
.mydomain-paging .paginationjs{
	text-align: center!important;
	margin: 0 auto;
}

.mydomain-name
{
	font-weight: bold; 
	padding: 10px;
	word-break: break-all;
	line-height: 1.2;
	margin-top: 5px;
}

.mydomain-item{
	background-color: rgb(255, 255, 255);
	border: 1px solid #ced4da;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    border-radius: 6px;
	padding:10px;
	text-align: center;
	position: relative;
}

.warp-setavatar
{
	margin:20px;
}

.warp-setavatar .setavatar
{
	width: 500px; height: 500px;
	background: linear-gradient(45deg, #3a4bcf, #ac148b);
	background-position: center center;
	position: relative;
	margin: 0 auto;
}
.warp-setavatar .setdomain{
	position: absolute;
    top: 75%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #FFF;
    font-weight: bold;
    font-size: 30px;
    word-wrap: break-word;
	z-index: 3;
}

.warp-setavatar .setselectimage{
	position: absolute;
	bottom: 20px;
    right: 20px;
	z-index: 2;
}

.warp-setavatar .setyoupic{
	position: absolute;
	top: 0;
    left: 0;
	z-index: 1;
	width: 500px;
	height: 500px;
	overflow: hidden;
}


.warp-setavatar .btn-file{
	position: relative;
	padding-top: 15px;
	padding-right: 10px;
	padding-left: 10px;
	cursor: pointer;
	margin-top: 20px;
	border-radius: 5px;
	background: #FFF;
}

.warp-setavatar input[type=file] {
	position: absolute;
	top: 0;
	right: 0;			
	text-align: right;
	filter: alpha(opacity=0);
	opacity: 0;
	outline: none;
	background: white;
	cursor: pointer;
	display: block;
}
.warp-setavatar .btn-confirm-avatar{
	width: 500px; 
	margin-top: 20px; 
	margin-bottom: 10px;
	cursor: pointer;
}

.btn-remove-avatar{
	position: absolute;
	top: 10px; right: 10px;
	color: #007bff
}


.btn-remove-avatar:hover{
	color: #FFF
}

.modal-open .modal {
        display: flex !important;
        align-items: center;
        justify-content: center;
    }

    .modal-dialog {
        width: 600px;
        font-size: 14px;
    }

div[data-notify="container"] { 
    width: auto; 
	margin-left: 30px;
}

.emoji-picker{
	border: 0;
    padding-right: 20px;
	line-height: 50px;
    cursor: pointer;
	position: relative;
	color: #FFF; 
}

.emoji-load{
	position: absolute;
	top: 35px;
	right: 0px;
	z-index: 9999;
}

</style>
</head>
<body>
<div class="warp-header" id="home">
	<div class="container">
		<div class="row">
			<div class="col-md-2 col-sm-2 col-xs-12">
				<div class="logo">
					<a href="/"><img src="/logo/logo.png?v=4" /></a>
				</div>
			</div>
			<div class="col-md-10 col-sm-10 col-xs-12 text-right">
				<div class="menu">
					<div class="menu-close"><i class="fal fa-times-circle"></i></div>
					<ul class="nav">
						<li class="nav-item active"><a data-id="" href="/">Home</a></li>
						<li class="nav-item"><a href="/app">Launch App</a></li>
						<li class="nav-item"><a href="/yourdomain">Find Your Domain</a></li>
					</ul>
				</div>
			</div>
			<div class="menu-overlay"></div>
		</div>
	</div>
	<div class="click-menu">
		<i class="fal fa-bars"></i>
	</div>
</div>
<div class="warp-banner text-center">
	<div class="banner-gradient"></div>
	<div class="warp-search">
		<div class="banner-nofix">
			<div class="container">
				<div class="warp-form-search">
					<div class="form-search">
							<div class="input-group">
								<textarea class="form-control form-control-lg txtdomain" style="height:200px; border: 1px solid #DDD; padding:10px; margin-bottom: 15px;" placeholder="Search domains"></textarea>
							</div>
							<div class='small tex-right' style="padding-bottom:5px; margin-bottom:10px; text-align: right;">Enter an xdc domain for each line</div>
							<div style="padding-bottom:5px; margin-bottom:20px;"><span class="btn btn-default btn-success btn-outline-secondary btn-search" style="cursor:pointer;border-radius: 6px"><i class="fas fa-spinner fa-spin" style="display:none;margin-right:5px;"></i>Check</span></div>
					  </div>
				</div>
			</div>
		</div>
		<div class="warp-result">
				<div class="container">
					<div class="result-search" style="display:none;">
					<div class='result-select'></div>
					<div class="result-common" style="display:none;">
							<span class='result-logo'></span>
							<span class='result-domain'></span>
							<span class='result-status'>
								<span class='result-chain' style='display:none;'></span>
								<span class='result-statustext'></span>
							</span>
					</div>
				</div>
			   </div>
		</div>
	</div>
</div>
<div class="warp-footer">
	<div class="container text-center">
		<div class="warp-social">
			<a class="social-twiter" href="https://twitter.com/xdcdomains" target="_blank" class="wow fadeInUp"><i class="fab fa-twitter"></i></a>
			<a class="social-github" href="https://github.com/XDCWeb3Domains" style="" target="_blank" class="wow fadeInUp"><i class="fab fa-github-alt"></i></a>
			<a class="social-discord" href="#" style="display:none;" class="wow fadeInUp"><i class="fab fa-discord"></i></a>
		</div>
	</div>
	<div class="warp-copyright">
		<div class="container text-center">
			Copyright © 2022 XDC Web3 Domains. All Rights Reserved.
		</div>
	</div>
</div>
<div class="back-to-top">
	<i class="far fa-angle-up"></i>
</div>
<script type="text/javascript">

	var currentNetwork;
	
	var contractFirst;
	
	var currentAddress;
	
	var domainReverse = '';
	
	var clickenble = true;
	
	var isConnection = false;

	window.addEventListener('load', async () => {
		await connect();
    });
	
	$(document).on('keyup', '.txtdomain', function(){
		//var str = $(this).val().trim().toLowerCase();
		//var lines = str.split("\n");
		//var temp = '';
		//for (var i = 0; i < lines.length; i++) {
		//	temp += fixDomain(lines[i]) + '\n';
		//};
		//$(this).val(temp);
    });
	
	const connect =  async () => {
		if (isConnection == true){
			return;
		}
		
		window.web3 = new Web3(new Web3.providers.HttpProvider('https://rpc.xinfin.network'));
		
		try {

			  const chainId = await web3.eth.net.getId();
			  
			  currentNetwork = getObjects(networks, "chainId", chainId)[0];
			  
			  if (currentNetwork == null || currentNetwork.visible == false)
			  {
					$('.not-support').show();
					notify('alert-danger', '<span class="text-danger">The network is not currently supported</span>');
					return;
			  }
			  
			  if (currentNetwork.contactAddress == null){
					notify('alert-danger', "<span class='text-danger>This contract object doesn't have address set yet, please set an address first.</span>");
					return;
			  }
			  
			  var chain = currentNetwork.chain;
			  
			  $('.list-item').each(function(){
					var _chain = $(this).attr('data-chain');
					if (_chain == chain.toLowerCase()){
						$(this).click();
						return;
					}
			  });

			  var abi = await fetchABI();
			
			  try{
				  contractFirst = new web3.eth.Contract(
								  abi,
								  currentNetwork.contactAddress
				  );
			  }catch(e){
				notify('danger', '<span class="text-danger">' + e.toString() + '</span>');
				//return;
			  }
			  
			  if (contractFirst == null)
			  {
					notify('alert-danger', '<span class="text-danger">Contract address not yet supported</span>');
					return;
			  }
			  
			  preInit();
			  
			  isConnection = true;
			  
		} catch (err) {
			notify('alert-danger', '<span class="text-danger">Error: ' + err.toString() + '</span>');
			
			$('.btn-connect-wallet i.fa-spin').hide();
		
			$('.btn-connect-wallet').removeAttr('disabled');
		}
	};
	
	const fetchABI = async () =>
	{
		const d = new Date();
		const response = await fetch('/contract/Web3Domains.json?t=' + d.getMilliseconds());
		const result = await response.json();
		const abi = result.abi;
		return abi;
	};
	
	
	const searchDomainTLD = async (domain) => {
		
		var tlds = [".xdc"];
		
		var temp = '';
		
		var domains = domain.split("\n");
				
		for (i = 0; i < domains.length; i++) {
		
			var domainitem = fixDomain(domains[i]);
				
			var tld = tlds[0];

			var fulldomain = fullDomain(domainitem, tlds[0]);
				
			var owner = '';
				
			try {
					owner = await contractFirst.methods.getOwner(fulldomain).call();
			} catch (e) {

			}
			var status = 'Unavailable';
			var css = 'text-danger';
			var icon = 'fa-ban';
				
			var isBook = false;
				
			var isBookingListActive = await contractFirst.methods._isBookingListActive().call();
			if (isBookingListActive == true){
				var chkInBookingList = await contractFirst.methods.chkInBookingList(domainitem).call();
				if (chkInBookingList == true)
				{
					isBook = true;
				}
			}
			var buy = '#';
			if (owner == '' && isBook == false)
			{
				status = 'Available';
				css = 'text-success';
				icon = 'fa-check-circle';
				buy = '/buy';
			}
				
			temp += "<div data-domain='" + domainitem + "' data-tld='" + tld + "' class='domain-item " + css + "'><a class='" + css + "' href='" + buy + "'><span class='domain-item-name'>" + fulldomain + "</span></a><span class='domain-item-status'><i class='fas " + icon + "'></i></span></div>";
		};
		
		$('.result-select').html(temp);
		
		$('.result-search').show();
	};
	
	const myDomainLoad = async (address, data, refresh) => {
	
		$('.mydomain-show').html('');
		
		$('.loading').show();
		
		var tokens = [];

		for (i = 0; i < data.length; i++) 
		{
			var tokenId = await contractFirst.methods.tokenOfOwnerByIndex(address, data[i]).call();
			try{
				var domain = await contractFirst.methods._tokenURIs(tokenId).call();
				var obj = new Object();
				obj.owner = address;
				obj.tokenId = tokenId;
				obj.domain = domain;
				tokens.push(obj);
			}catch{}
		};
		
		if (tokens.length > 0){
		
			$('.loading').hide();
			
			$('.warp-mydomains').show();
			
			const d = new Date();
			var t =d.getTime();
			
			$.each(tokens, function(index, obj){
				var endpoint = '/api/nftdomains/metadata/' + obj.domain;
				$.getJSON(endpoint, function(result) {   
					var name = result.name;
					var image = result.image + '?t=' + t;
					var symbol = result.symbol;
					var btnlbl = 'Set Primary';
					var isremove = "false";
					if (name == domainReverse){
						btnlbl = "Remove Primary";
						isremove = "true";
					}
					
					var temp = "<div class='mydomain-item'><a target='_blank' href='" + image + "'><img style='width: 100%;' src='" + image + "' /></a><div style='cursor:pointer; margin-top: 5px;' data-obj='" + JSON.stringify(obj) + "'title='Remove NFT Avatar' class='btn btn-remove-avatar'><i class='fas fa-trash-alt'></i></div><div style='cursor:pointer; margin-top: 5px;' data-remove='" + isremove + "' data-domain='" + name + "' class='btn btn-sm btn-outline-success btn-set-reverse'>" + btnlbl + "</div><div style='cursor:pointer; margin-top: 5px;' data-obj='" + JSON.stringify(obj) + "' class='btn btn-sm btn-outline-primary btn-set-avatar'>Set Avatar</div></div>"
					$('.mydomain-show').append(temp);
				});
			});
		}
	};

	const myDomains = async (address, refresh) => {
	
		$('.warp-mydomains').show();
		
		$('.mydomain-show').html('');
		
		var balance = await contractFirst.methods.balanceOf(address).call();
		
		$('.total-domains').html(balance);
		
		var pageSize = 15;
		var totalNumber = balance;
		var dataSource = [];
		for (i = 0; i < balance; i++) {
			dataSource.push(i);
		}
		
		$('.paging').pagination({
			dataSource: dataSource,
			totalNumber: balance,
			pageSize: pageSize,
			showPrevious: true,
			showNext: true,
			className: 'paginationjs-theme-blue paginationjs-big',
			showGoInput: true,
			showGoButton: true,
			callback: function(data, pagination) {
				myDomainLoad(address, data, refresh);
			}
		});
	};
	
	const preInit = () => 
	{
		  $(document).on('click', '.btn-search', async function(){
				var domain = $('.txtdomain').val().trim().toLowerCase();

				if (domain == ''){
					$('.result-search').hide();
					return;
				}

				if (domain.length < 2){
					$('.result-search').hide();
					notify('danger', '<span class="text-danger">Domain requires at least 2 characters</span>');
					return;
				}
				
				$('.btn-search i').show();
				
				await searchDomainTLD(domain);
				
				$('.btn-search i').hide();

		  });
    };
	
	
	const notify = function (type, msg) {
		$.notify({
			message: '<span class="small">' + msg + '</span>',
			type: type
		}, {
			delay: 7000, placement: {

				from: "bottom",
				align: "center"
			}
		});
	};
			
	
	function copyToClipboard(text) {
	  var $temp = $("<input>");
	  $("body").append($temp);
	  $temp.val(text).select();
	  document.execCommand("copy");
	  $temp.remove();
	}
	
	function fullDomain(domain, tld)
	{
		domain = fixDomain(domain) + tld;
		return domain;
	}
	
	function fixDomain(domain)
	{
		//	_char = _char.replace(/\./g, '').replace(/\s+/g, '').replace(/[^A-Za-z0-9\-]/gi, '').replace(/,/g, '');
		const domainfix = domain.replace(/\./g, '').replace(/\s+/g, '').replace(/[`~!@#$%^&*()_|+\=?;:'",.<>\{\}\[\]\\\/]/gi, '').replace(/,/g, '');
		return domainfix;
	}
</script>

</body>
</html>